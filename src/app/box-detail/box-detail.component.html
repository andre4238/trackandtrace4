<div class="box-detail-container" [class.open]="isOpen">
  <div class="headerbox">
    <h2>{{ task.name }}</h2>
    <button class="close-btn" (click)="close()">×</button>
  </div>
  <div class="box-detail-content">
    <div class="subtasks">
      <ul>
        <li *ngFor="let subtask of subtasks" [class]="getSubtaskClass(subtask.name)">
          {{ subtask.name }}
        </li>
      </ul>
    </div>
    <button id="servicebutton" class="btn btn-secondary" (click)="openServiceModal()">Support</button>

    <div *ngIf="fedexStatus" class="fedex-status-container">
      <h3 id="fedexheader"><b>FedEx Tracking Status</b></h3>
      <div class="fedex-status-box">
        <h4>Tracking Information</h4>
        <p>
          <strong>Tracking Number: </strong>
          <a [href]="'https://www.fedex.com/fedextrack/?trknbr=' + fedexStatus.trackingNumber + '&status=' + fedexStatus.status">
            {{ fedexStatus.trackingNumber }}
          </a>
        </p>
        <p><strong>Status:</strong> {{ fedexStatus.status }}</p>
      </div>

      <div class="fedex-status-box" *ngIf="fedexStatus.recipient">
        <h4>Recipient Information</h4>
        <p><strong>City:</strong> {{ fedexStatus.recipient.city }}</p>
        <p><strong>Country:</strong> {{ fedexStatus.recipient.countryName }} ({{ fedexStatus.recipient.countryCode }})</p>
      </div>

      <div class="fedex-status-box" *ngIf="fedexStatus.weight">
        <h4>Weight</h4>
        <ul>
          <li *ngFor="let weight of fedexStatus.weight">
            {{ weight.value }} {{ weight.unit }}
          </li>
        </ul>
      </div>

      <div class="fedex-status-box" *ngIf="fedexStatus.deliveryDetails">
        <h4>Delivery Details</h4>
        <p><strong>Actual Delivery Address:</strong> {{ fedexStatus.deliveryDetails.actualDeliveryAddress.city }}, {{ fedexStatus.deliveryDetails.actualDeliveryAddress.countryName }} ({{ fedexStatus.deliveryDetails.actualDeliveryAddress.countryCode }})</p>
        <p><strong>Location Description:</strong> {{ fedexStatus.deliveryDetails.locationDescription }}</p>
        <p><strong>Delivery Attempts:</strong> {{ fedexStatus.deliveryDetails.deliveryAttempts }}</p>
        <p><strong>Received By:</strong> {{ fedexStatus.deliveryDetails.receivedByName }}</p>
      </div>

      <a id="fedexlinkbutton" [href]="'https://www.fedex.com/fedextrack/?trknbr=' + fedexStatus.trackingNumber + '&status=' + fedexStatus.status" class="btn btn-primary">
        Show in FedEx
      </a>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="serviceModal" tabindex="-1" aria-labelledby="serviceModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="serviceModalLabel">Service Request</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeServiceModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <ul class="list-group mb-3">
            <li class="list-group-item"><strong>Task:</strong> {{ task.name }}</li>
            <li class="list-group-item"><strong>Tracking Number:</strong> {{ trackingNumber }}</li>
            <li class="list-group-item"><strong>Status:</strong> {{ fedexStatus.status }}</li>
            <!-- Add more details as needed -->
          </ul>
          <div class="mb-3">
            <label class="form-label">Issue:</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="issue" value="defective" id="defective">
              <label class="form-check-label" for="defective">
                Defekter Artikel
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="issue" value="wrong-delivery" id="wrong-delivery">
              <label class="form-check-label" for="wrong-delivery">
                Falschlieferung
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="issue" value="return" id="return">
              <label class="form-check-label" for="return">
                Rückgabe
              </label>
            </div>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email:</label>
            <input type="email" class="form-control" id="email" name="email" required>
          </div>
          <div class="mb-3">
            <label for="additionalDetails" class="form-label">Zusätzliche Details:</label>
            <textarea class="form-control" id="additionalDetails" name="additionalDetails" rows="4" required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>
